{% extends 'strecklista/base.html' %}
{% block content %}
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<style>
{% include 'strecklista/components/products.css' %}
{% include 'strecklista/components/transactions.css' %}
{% include 'strecklista/components/usercard.css' %}
</style>
<script>
  $(function() {
    var $body = $('body');

    handleClick('.transactionSubmit', '/transaction/');
    handleClick('.returnTransaction', '/returnTransaction/');

    function handleClick(target, path) {
      $body.on('click', target, function(e) {
        e.preventDefault();
        var $button = $(this).prop('disabled', true);

        $.post(path, $(this.parentElement).serialize())
          .then(success)
          .always(function () {
            $button.prop('disabled', false);
            refreshTransactions();
            refreshAlert();
          });
      });
    }

    function success() {
      $body.css('background-color', 'green');
      setTimeout(function() {
        $body.css('background-color', 'white');
      }, 500);
    }

    function refreshAlert() {
      $('#balanceAlertContainer').load('/ #balanceAlertContainer div');
    }
    function refreshTransactions() {
      $('#transactionrow').load('/ #transactionrow > *');
    }

    $('.alcometer').tooltip()

  });
</script>
{% include "strecklista/snippets/navbar.html" %}
<style>
.tabs {
  position: fixed;
  bottom: 0;
  height: 50px;
  width: 100%;
  background: #eee;
  display: flex;
  z-index: 100;
  box-shadow: 0 0 3px 1px rgba(0,0,0,.2);
}

.tab-option .ink {
  position: absolute;
  border-radius: 50%;
  background-color: firebrick;
  margin-left: -100px;
  margin-top: -100px;
  height: 200px;
  width: 200px;
  transition: transform .4s, opacity .2s .2s;
  transform: scale(1);
  opacity: 0;
}

.ink.initial {
  transform: scale(.001);
  opacity: .2;
}

.tabs > .tab-option {
  position: relative;
  overflow: hidden;
  flex: 1;
  display: inline-flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  color: #333;
}

.tabs > .tab-option[aria-selected=true] {
  color: firebrick;
  font-weight: bold;
}

.tabs-viewport {
  margin-top: -50px;
  padding: 50px 0;
  height: 100vh;
  overflow: hidden;
}

.tabs-container {
  width: 300vw;
  height: 100%;
  transition: .25s transform ease;
}

.tab-content {
  padding: 10px;
  padding-bottom: 60px;
  width: 100vw;
  height: 100%;
  float: left;
  overflow-y: scroll;
  -webkit-overflow-scrolling: touch;
}
</style>
<div class="tabs" role="tablist">
  <div class="tab-option" role="tab" aria-selected="true">
    <i class="material-icons" aria-hidden="true">local_bar</i>
    <span>Streque</span>
  </div>
  <div class="tab-option" role="tab" aria-selected="false">
    <i class="material-icons" aria-hidden="true">list</i>
    <span>Dryckeslista</span>
  </div>
  <div class="tab-option" role="tab" aria-selected="false">
    <i class="material-icons" aria-hidden="true">history</i>
    <span>Historik</span>
  </div>
  <script>
  $(function () {
    function offset(name, el, pos) {
      while (!el.classList.contains(name)) {
        pos.left += el.offsetLeft;
        pos.top += el.offsetTop;
        el = el.parentElement;
      }
      return pos;
    }
    $('.tabs').on('click', 'div', function (e) {
      var $tab = $(this);
      $('.tabs-container').css('transform', 'translate3d(-' + $tab.index() + '00vw,0,0)');

      $('.tabs > div').attr('aria-selected', false);
      $tab.attr('aria-selected', true);

      var pos = offset('tab-option', e.target, {
        top: e.offsetY,
        left: e.offsetX,
      });
      var $ink = $('<div>').addClass('ink initial').css(pos).appendTo($tab)

      setTimeout(function() {
        $ink.removeClass('initial');
        setTimeout(function () {
          $ink.remove();
        }, 300)
      }, 30);
    });
  });
  </script>
</div>
<div class="tabs-viewport">
  <div class="tabs-container">
    {# STREQUE #}
    <div id="streque-tab" class="tab-content">
      <div id="balanceAlertContainer">
        {% if user.balance < 100 %}
          <div class="alert {% if user.balance < 0 %}alert-danger{% else %}alert-warning{% endif %}">
            Det {% if user.balance < 0 %}finns inga{% else %}är ont om{% endif %} pengar på kontot. Dags att fylla på?
          </div>
        {% endif %}
      </div>
      {%if quote%}
      <blockquote>
        {{quote.text}}
        <p style="font-style: italic;text-align: right;">&mdash; {{quote.who}}</p>
      </blockquote>
      {% endif %}
      {%include 'strecklista/components/usercard.html' with user=current_user drinks=price_group_list %}

      <h2>Alla</h2>
      {% if group_list and user_list and price_group_list %}
        {% for group in group_list %}
          <h3>{{group.name}}</h3>
          {% for user in user_list %}
            {% if group == user.group %}
              {%include 'strecklista/components/usercard.html' with user=user drinks=price_group_list %}
            {% endif %}
          {% endfor %}
        {% endfor %}
      {% endif %}
    </div>
    {# DRINKS #}
    <div id="drinks-tab" class="tab-content">
      {% include 'strecklista/components/products.html' with categories=drink_categories %}
    </div>
    {# HISTORY #}
    <div id="history-tab" class="tab-content">
      {% include 'strecklista/components/transactions.html' with transactions=transactions %}
    </div>
  </div>
</div>
{% endblock %}
